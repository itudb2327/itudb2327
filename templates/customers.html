{% extends "base.html" %} {% block page_content %}
<div class="container" style="padding-top: 8%;">
  <form action="/customers" method="get">
    <label for="sort">Sort by:</label>
    <select name="sort_by" id="sort">
      <option value="id">ID</option>
      <option value="company">Company</option>
      <option value="first_name">First Name</option>
      <option value="last_name">Last Name</option>
      <option value="job_title">Job Title</option>
      <option value="business_phone">Business Phone</option>
      <option value="address">Address</option>
      <option value="city">City</option>
    </select>
    <input type="submit" class="btn btn-success" value="Sort" />
  </form>
  <div class="mt-4">
    <table class="table table-light table-striped table-hover">
      <thead>
        <tr>
          <th scope="col">ID</th>
          <th scope="col">Company</th>
          <th scope="col">First Name</th>
          <th scope="col">Last Name</th>
          <th scope="col">Job Title</th>
          <th scope="col">Business Phone</th>
          <th scope="col">Address</th>
          <th scope="col">City</th>
          <th scope="col">Update</th>
          <th scope="col">Delete</th>
        </tr>
      </thead>
      <tbody class="table-group-divider">
        {% for customer in customers_list %}
        <tr>
          <th scope="row">{{ customer.id }}</th>
          <td>{{ customer.company }}</td>
          <td>{{ customer.first_name }}</td>
          <td>{{ customer.last_name }}</td>
          <td>{{ customer.job_title }}</td>
          <td>{{ customer.business_phone }}</td>
          <td>{{ customer.address }}</td>
          <td>{{ customer.city }}</td>
          <td><button id="updateButton" class="btn btn-primary">Update</button></td>
          <td><form action="/customers" method="POST" id="deleteForm">
            <input type="hidden" name="customer_id" value="{{ customer.id }}">
            <button type="submit" class="btn btn-danger" data-toggle="modal" data-target="#deleteModal">Delete</button>
          </form>
        </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this customer?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>
</div>
</div>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
  document.querySelectorAll('.btn-danger').forEach(function (button) {
      button.addEventListener('click', function (event) {
          event.preventDefault();
          var customerId = button.parentElement.querySelector('[name="customer_id"]').value;
          $('#deleteModal').modal('show');
          document.getElementById('confirmDelete').addEventListener('click', function () {
              document.getElementById('deleteForm').submit();
          });
          document.getElementById('cancelDelete').addEventListener('click', function () {
              $('#deleteModal').modal('hide');
          });
      });
  });
</script>



{% endblock %}
